<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Practical Project Record</title>
</head>
<body>
  <h1>Practical Project Record</h1>

  <% sciencepracticaldata.forEach((student, index) => { %>
    <h2>Student Name: <%= student.name %> | Roll: <%= student.roll %></h2>
    <p>Class: <%= student.studentClass %> | Section: <%= student.section %></p>

    <table border="1" cellspacing="0" cellpadding="5">
      <tr>
        <th rowspan="2">SN</th>
        <th rowspan="2">Unit</th>
        <th colspan="3">Practical</th>
        <th colspan="3">Project</th>
        <th>Remarks</th>
      </tr>
      <tr>
        <th>Total Practical Given</th>
        <th>Total Practical Done</th>
        <th>Obtained Practical Marks</th>
        <th>Total Project Given</th>
        <th>Total Project Done</th>
        <th>Obtained Project Marks</th>
      </tr>

      <% let totalGivenAllPractical = 0; %>
      <% let totalGivenAllProject = 0; %>
      <% let totalObtainedAllPractical = 0; %>
      <% let totalObtainedAllProject = 0; %>
      <% let totalDoneAllPractical = 0; %>
      <% let totalDoneAllProject = 0; %>


      <% lessonData.forEach((lesson) => { %>
        <% lesson.units.forEach((unit, uIndex) => { 
          // Find corresponding unit in student data safely
          const studentUnit = student.unit?.find(u => u.unitName === unit.unitName) || { practicals: [], projectWorks: [] };

          // Practical counts & marks
          const totalPracticalGiven = unit.practicals?.length || 0;
          const totalPracticalDone = studentUnit.practicals?.length || 0;
          const obtainedPracticalMarks = studentUnit.practicals?.reduce((sum, p) => sum + (p.practicalMarks || 0), 0);

          // Project counts & marks
          const totalProjectGiven = unit.projectworks?.length || 0;
          const totalProjectDone = studentUnit.projectWorks?.length || 0;
          const obtainedProjectMarks = studentUnit.projectWorks?.reduce((sum, p) => sum + (p.projectMarks || 0), 0);
        %>
        %>
<% totalGivenAllPractical += totalPracticalGiven; %>
<% totalGivenAllProject += totalProjectGiven; %>
<% totalObtainedAllPractical += obtainedPracticalMarks; %>
<% totalObtainedAllProject += obtainedProjectMarks; %>
<% totalDoneAllPractical += totalPracticalDone; %>
<% totalDoneAllProject += totalProjectDone; %>

        <tr>
          <td><%= uIndex + 1 %></td>
          <td><%= unit.unitName %></td>
          <td><%= totalPracticalGiven %></td>
          <td><%= totalPracticalDone %></td>
          <td><%= ((obtainedPracticalMarks)/10)*20%></td>
          <td><%= totalProjectGiven %></td>
          <td><%= totalProjectDone %></td>
          <td><%= ((obtainedProjectMarks)/8)*16 %></td>
          <td></td>
        </tr>
     
        <% }) %>
      <% }) %>
         <tr>
          <td></td>
          <td>Total</td>
      
          <td><%= totalGivenAllPractical %></td>
          <td><%= totalDoneAllPractical %></td>
           <td><%= ((totalObtainedAllPractical)/10)*20 %></td>
          <td><%= totalGivenAllProject %></td>
          <td><%= totalDoneAllProject %></td>

          <td><%= ((totalObtainedAllProject)/8)*16 %></td>
        </tr>
        <tr>
          <td></td>
          <td>Average</td>
          <td></td>
          <td></td>
          <td><%= (((totalObtainedAllPractical)/10)*20) / lessonData[0].units.length %></td>
          <td></td>
          <td></td>
          <td><%= ((totalObtainedAllProject)/8)*16 / lessonData[0].units.length %></td>
        </tr>
    </table>
    <br><br>
  <% }) %>
</body>
</html>

