<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Practical</title>
</head>
<body>
  <form action="/practicaldetailform" method="POST">
    <input type="text" name="roll" placeholder="Enter Roll">
    <input type="text" name="name" placeholder="Enter Name">
    <input type="text" name="studentClass" value="<%= studentClass %>" placeholder="Enter Student Class">
    <input type="text" name="section" value="<%= section %>" placeholder="Enter Section">
    <input type="text" name="terminal[0][subject][0][subjectName]" value="<%= subject %>" placeholder="Enter Subject"> <br>
     <input type="text" name="terminal[0][terminalName]" placeholder="Enter Terminal"> <br>
   <center><h1>Attendance Marks </h1></center> 
   <input type="number" name="terminal[0][totalAttendance]" placeholder="Enter Total attendance" id="attendanceDays" oninput="calculateAttendanceMarks()">
   <input type="number" name="terminal[0][attendanceMarks]" placeholder="attendanceMarks" readonly id="attendanceMarks" step="0.1"> <br>
   <center><h1>Terminal Marks</h1></center>
   <input type="number" name="terminal[0][subject][0][theoryMarks]" placeholder="Terminal Marks"  id="theoryMarks" step="0.1" oninput="calculateTerminalMarks()">    
   <input type="number" name="terminal[0][subject][0][terminalMarks]" placeholder="Obtained Converted Marks" readonly id="obtainedconvertedmarks" step="0.1"> <br>
     <center><h1>Practical/Project Work Marks</h1></center> <br>
  
     

<table border="1" cellspacing="0">
  <tr>
    <th>S.No</th>
    <th>मुल्याङ्कनका आधार (Theme)</th>
    <th>परिक्षण पक्ष (Learning Outcome)</th>
    <th>सूचक (Indicator)</th>
    <th>Obtained Marks</th>
    <th>Remarks</th>
  </tr>

 
 
<%= iIndex = 0 %>

<% practicalFormatData.forEach(function(doc) { %>
  <% doc.themes.forEach(function(theme) { %>
    <% theme.learningOutcome.forEach(function(lo) { %>
      <% let mulyIndex = iIndex; %> <!-- one index per Theme+LO -->
      <% lo.indicators.forEach(function(ind, indIndex) { %>
        <tr>
          <% if (indIndex === 0) { %>
            <td rowspan="<%= lo.indicators.length %>"><%= iIndex+1 %></td>
            <td rowspan="<%= lo.indicators.length %>"><%= theme.themeName %></td>
            <td rowspan="<%= lo.indicators.length %>"><%= lo.learningOutcomeName %></td>
          <% } %>

          <td><%= ind.indicatorName %></td>
          <td>
            <%= ind.indicatorsMarks %>
            <!-- SAME mulyIndex for all indicators of this Theme+LO -->
            <input type="radio" 
                   name="terminal[0][subject][0][mulyangkanAdhar][<%= mulyIndex %>][praptangka]" 
                   value="<%= ind.indicatorsMarks %>" onclick="document.getElementById('prapta<%= mulyIndex %>').value='<%= ind.indicatorName %>'">
                   
          </td>

          <!-- Only one hidden for this mulyIndex -->
          <% if (indIndex === 0) { %>
            <input type="hidden" name="terminal[0][subject][0][mulyangkanAdhar][<%= mulyIndex %>][mulyangkanName]" value="<%= theme.themeName %>">
            <input type="hidden" name="terminal[0][subject][0][mulyangkanAdhar][<%= mulyIndex %>][parixyanPakxhya]" value="<%= lo.learningOutcomeName %>">
            <input type="hidden" id="prapta<%= mulyIndex %>" name="terminal[0][subject][0][mulyangkanAdhar][<%= mulyIndex %>][praptaSuchak]" value="">
          <% } %>
        </tr>
      <% }) %>
      <%= iIndex++ %>
    <% }) %>
  <% }) %>
<% }) %>


</table>

<input type="Submit">
 



  </form>

  






  <script>

    //populating terminal
    const terminal = window.location.search;
    
    const terminalParams = new URLSearchParams(terminal);
    
    const terminalValue = terminalParams.get('terminal');
    document.querySelector('input[name="terminal"]').value = terminalValue;
function calculateTerminalMarks() {
      const terminal = window.location.search;
    
    const terminalParams = new URLSearchParams(terminal);
    
    const terminalValue = terminalParams.get('terminal');
  
    if(terminalValue === "FIRST-2082")
  {
    const theoryMarks = parseFloat(document.getElementById('theoryMarks').value);
    document.getElementById('obtainedconvertedmarks').value = 0.1 * theoryMarks;
  }
}

    function calculateAttendanceMarks() {
     const attendanceDays = parseInt(document.getElementById('attendanceDays').value, 10) || 0;
      const totalWorkingDays = 40;
      const attendancePercentage = (attendanceDays / totalWorkingDays) * 100;
      console.log(attendancePercentage);

      if(attendancePercentage >=90 && attendancePercentage <=100) {
        
        document.getElementById('attendanceMarks').value = 2;
      }
      else if(attendancePercentage >= 85 && attendancePercentage < 90) {
      
        document.getElementById('attendanceMarks').value = 1.5;
      }
      else if(attendancePercentage >= 80 && attendancePercentage < 85) {
       
        document.getElementById('attendanceMarks').value = 1;
      }
      else if(attendancePercentage >=75 && attendancePercentage < 80) {
     
        document.getElementById('attendanceMarks').value = 0.5;
      }
      else {
        document.getElementById('attendanceMarks').value = 0;
      }
    }
  </script>

</body>
</html>