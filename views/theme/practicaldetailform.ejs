<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Practical</title>
</head>
<body>
  <form action="/practicaldetailform?studentClass=<%= studentClass %>&section=<%= section %>&subject=<%= subject %>&terminal=<%= terminal.terminal %>" method="POST">
    <input type="text" name="roll" placeholder="Enter Roll">
    <input type="text" name="name" placeholder="Enter Name">
    <input type="text" name="studentClass" value="<%= studentClass %>" placeholder="Enter Student Class">
    <input type="text" name="section" value="<%= section %>" placeholder="Enter Section">
    <input type="text" name="terminal[0][subject][0][subjectName]" value="<%= subject %>" placeholder="Enter Subject"> <br>
     <input type="text"  id="terminal" name="terminal[0][terminalName]" placeholder="Enter Terminal"> <br>
   <center><h1>Attendance Marks </h1></center> 
   <input type="number" name="terminal[0][totalAttendance]" placeholder="Enter Total attendance" id="attendanceDays" oninput="calculateAttendanceMarks()">
   <input type="number" name="terminal[0][attendanceMarks]" placeholder="attendanceMarks" readonly id="attendanceMarks" step="0.1"> <br>
   <center><h1>Participation Marks
    <table border="1" cellspacing="0" cellpadding="0">
  <tr>
    <th>आधार </th>
    <th>स्तर</th>
    <th>अंक</th>
  </tr>
  <tr>
    <td rowspan="4">सक्रियता र सहभागिता</td>
    <td>
      सिकाइमा जिज्ञासा राख्दै, समूह छलफल र अन्तरक्रियामा सक्रियतापूर्वक भाग लिएको, 
      आफ्ना विचार निर्वाध र स्वतन्त्र रूपमा प्रस्तुत गरेको, दिइएका सम्पूर्ण कार्य स्वयंमले पूरा गरेको

    </td>
    <td>सर्वोत्कृष्ट</td>
    <td>२ <input type="radio" name="[terminal][0][subject][0][participationMarks]" value="2"></td>
  </tr>
  <tr>
    <td>
      सिकाइमा जिज्ञासा राख्दै, समूह छलफल र अन्तरक्रियामा कम सक्रियतापूर्वक भाग लिएको, 
      आफ्ना विचार स्वतन्त्र रूपमा प्रस्तुत गरेको, दिइएका अधिकांश कार्य पूरा गरेको
    </td>
    <td>उत्कृष्ट</td>
    <td>१.५ <input type="radio" name="[terminal][0][subject][0][participationMarks]" value="1.5"></td>
  </tr>
  <tr>
    <td>
      सिकाइमा कम जिज्ञासा राख्दै, समूह छलफल र अन्तरक्रियामा निर्देशानुसार भाग लिएको, 
      आफ्ना विचार आंशिक रूपमा मात्र प्रस्तुत गरेको, दिइएका कार्य आधा मात्र पूरा गरेको
    </td>
    <td>मध्यम</td>
    <td>१ <input type="radio" name="[terminal][0][subject][0][participationMarks]" value="1"></td>
  </tr>
  <tr>
    <td>
      सिकाइप्रति उदासीन रहेमा, समूह छलफल र अन्तरक्रियामा सक्रियता नदेखाएको, 
      आफ्ना विचार प्रस्तुत गर्न साथी वा शिक्षकको सहयोग चाहिएको, अरुको सहयोगमा दिइएको कार्य पूरा गरेको
    </td>
    <td>सामान्य</td>
    <td>०.५ <input type="radio" name="[terminal][0][subject][0][participationMarks]" value="0.5"></td>
  </tr>
</table>

   </h1></center>
   <center><h1>Terminal Marks</h1></center>
   <input type="number" name="terminal[0][subject][0][theoryMarks]" placeholder="Terminal Marks"  id="theoryMarks" step="0.1" oninput="calculateTerminalMarks()">    
   <input type="number" name="terminal[0][subject][0][terminalMarks]" placeholder="Obtained Converted Marks" readonly id="obtainedconvertedmarks" step="0.1"> <br>
     <center><h1>Practical/Project Work Marks</h1></center> <br>
  
     <div class="sciencecontainer" style="display: flex;">
<div class="left">



        <table border="1" cellspacing="0">
          <tr>
            <th>S.No</th>
            <th>मुल्याङ्कनका आधार (Theme)</th>
            <th>परिक्षण पक्ष (Learning Outcome)</th>
            <th>सूचक (Indicator)</th>
            <th>Obtained Marks</th>
            <th>Remarks</th>
          </tr>

          <% iIndex = 0 %>
          <% practicalFormatData.forEach(function(doc) { %>
            <% doc.themes.forEach(function(theme) { %>
              <% let themeRowspan = theme.learningOutcome.reduce((sum, lo) => sum + lo.indicators.length, 0); %>
              <% let firstThemeRow = true; %>

              <% theme.learningOutcome.forEach(function(lo) { %>
                <% let loRowspan = lo.indicators.length; %>
                <% let mulyIndex = iIndex; %>

                <% lo.indicators.forEach(function(ind, indIndex) { %>
                  <tr>
                    <% if(firstThemeRow && indIndex === 0) { %>
                      <td rowspan="<%= themeRowspan %>"><%= iIndex+1 %></td>
                      <td rowspan="<%= themeRowspan %>"><%= theme.themeName %></td>
                      <% firstThemeRow = false; %>
                    <% } %>

                    <% if(indIndex === 0) { %>
                      <td rowspan="<%= loRowspan %>"><%= lo.learningOutcomeName %></td>
                    <% } %>

                    <td><%= ind.indicatorName %></td>
                    <td>
                      <%= ind.indicatorsMarks %>
                      <input type="radio" 
                             name="terminal[0][subject][0][mulyangkanAdhar][<%= mulyIndex %>][praptangka]" 
                             value="<%= ind.indicatorsMarks %>" 
                             onclick="document.getElementById('prapta<%= mulyIndex %>').value='<%= ind.indicatorName %>'">
                    </td>

                    <% if(indIndex === 0) { %>
                      <input type="hidden" name="terminal[0][subject][0][mulyangkanAdhar][<%= mulyIndex %>][mulyangkanName]" value="<%= theme.themeName %>">
                      <input type="hidden" name="terminal[0][subject][0][mulyangkanAdhar][<%= mulyIndex %>][parixyanPakxhya]" value="<%= lo.learningOutcomeName %>">
                      <input type="hidden" id="prapta<%= mulyIndex %>" name="terminal[0][subject][0][mulyangkanAdhar][<%= mulyIndex %>][praptaSuchak]" value="">
                  
                     
                    <% } %>
                  </tr>
                <% }) %>

                <% iIndex++ %>
              <% }) %>
            <% }) %>
          <% }) %>
        </table>
        <br>


  



<input type="Submit">
 



  </form>

  






  <script>

    //populating terminal
    const terminal = window.location.search;
    
    const terminalParams = new URLSearchParams(terminal);
    
    const terminalValue = terminalParams.get('terminal');
    document.querySelector('#terminal').value = terminalValue;
function calculateTerminalMarks() {
      const terminal = window.location.search;
    
    const terminalParams = new URLSearchParams(terminal);
    
    const terminalValue = terminalParams.get('terminal');
  
    if(terminalValue !="FINAL")
  {
    const theoryMarks = parseFloat(document.getElementById('theoryMarks').value);
    document.getElementById('obtainedconvertedmarks').value = (( theoryMarks)/50)*10;
  }
  else if(terminalValue ==="FINAL")
  {
    const theoryMarks = parseFloat(document.getElementById('theoryMarks').value);
    document.getElementById('obtainedconvertedmarks').value = 0.2 * theoryMarks;
  }

}

    function calculateAttendanceMarks() {
     const attendanceDays = parseInt(document.getElementById('attendanceDays').value, 10) || 0;
      const totalWorkingDays = 40;
      const attendancePercentage = (attendanceDays / totalWorkingDays) * 100;
      console.log(attendancePercentage);

      if(attendancePercentage >=90 && attendancePercentage <=100) {
        
        document.getElementById('attendanceMarks').value = 2;
      }
      else if(attendancePercentage >= 85 && attendancePercentage < 90) {
      
        document.getElementById('attendanceMarks').value = 1.5;
      }
      else if(attendancePercentage >= 80 && attendancePercentage < 85) {
       
        document.getElementById('attendanceMarks').value = 1;
      }
      else if(attendancePercentage >=75 && attendancePercentage < 80) {
     
        document.getElementById('attendanceMarks').value = 0.5;
      }
      else {
        document.getElementById('attendanceMarks').value = 0;
      }
    }
  </script>

</body>
</html>